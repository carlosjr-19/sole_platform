{% extends 'layout.html' %}

{% block head %} 
<link href="{{ url_for('static', filename='css/contracargos.css') }}" rel="stylesheet" />
<link href="{{ url_for('static', filename='css/modal.css') }}" rel="stylesheet" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
{% endblock %}

{% block titulo_h1 %} Contracargos {% endblock %}
{% block descripcion %} 
En esta sección podrás observar la lista de contracargos con cada uno de sus detalles, como a su filtrar busquedas a la que requiera el usuario.
{% endblock %}

{% block title %} Contracargos {% endblock %}

{% block info %}

<div class="header-actions">
    <a href="{{ url_for("add_contracargo") }}">
        <button class="btn-add">
            <i class="fas fa-plus"></i>
            Añadir contracargo
        </button>
    </a>
</div>


<div class="search-container">
    <form class="search-form" method="GET" action"{{ url_for('search_contracargo') }}">
        <div class="form-group">
            <i class="fas fa-search"></i>
            <input type="text" id="search" name="search" placeholder="Buscar">
        </div>
        <div class="form-group">
            <i class="fas fa-calendar"></i>
            <input type="date" id="fecha_desde" name="fecha_desde" placeholder="Fecha desde">
        </div>
        <div class="form-group">
            <i class="fas fa-calendar"></i>
            <input type="date" id="fecha_hasta" name="fecha_hasta" placeholder="Fecha hasta">
        </div>
        <input class="btn-search" type="submit" value="Buscar" formaction="{{ url_for('search_contracargo') }}">
    </form>
</div>

<div class="table-container">
    <table id="dataTable">
        <thead>
            <tr>
                <th>Nombre</th>
                <th>Correo</th>
                <th>MSISDN</th>
                <th>ORD Pay</th>
                <th>Fecha</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            <!-- Los datos se cargarán dinámicamente -->
            {% for contracargo in contracargos %}
                <tr>
                    <td>{{ contracargo.name }}</td>
                    <td>{{ contracargo.email }}</td>
                    <td>{{ contracargo.msisdn }}</td>
                    <td>{{ contracargo.ord_pay }}</td>
                    <td>{{ contracargo.date_inserted }}</td>
                    <td>
                        <a href="{{ url_for('edit_contracargo', contracargo_id=contracargo.id) }}" class="boton">
                            <i class='bx bxs-message-square-edit' style='color:#1bde57'></i>
                        </a>
                        <button onclick="openDeleteModal({{ contracargo.id }})" class="boton" style="background: none; border: none; cursor: pointer;">
                            <i class='bx bxs-trash' style='color:#f44040'></i>
                        </button>

                        <!-- Modal para confirmar eliminación -->
                        <div id="deleteModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.5); justify-content: center; align-items: center;">
                            <div style="background: white; padding: 20px; border-radius: 5px; width: 300px;">
                                <h3>Confirmar eliminación</h3>
                                <p>Por favor, ingresa la clave para confirmar la eliminación.</p>
                                <form id="deleteForm" method="POST">
                                    <input type="password" name="password" id="password" placeholder="Clave" required>
                                    <button type="submit">Confirmar</button>
                                    <button type="button" onclick="closeDeleteModal()" class="dlt-button">Cancelar</button>
                                </form>
                            </div>
                        </div>

                    </td>
                </tr>
                {% endfor %}
        </tbody>
    </table>
</div>
<div class="pagination">
    {% if page > 1 %}
        <a href="{{ url_for('list_contracargos', page=page-1, search=search, fecha_desde=request.args.get('fecha_desde'), fecha_hasta=request.args.get('fecha_hasta')) }}">
            <button>&laquo; Anterior</button>
        </a>
    {% endif %}

    {% for p in range(1, total_pages + 1) %}
        <a href="{{ url_for('list_contracargos', page=p, search=search, fecha_desde=request.args.get('fecha_desde'), fecha_hasta=request.args.get('fecha_hasta')) }}"
        class="{% if p == page %}active{% endif %}">
            <button>
                {{ p }}
            </button>
        </a>
    {% endfor %}

    {% if page < total_pages %}
        <a href="{{ url_for('list_contracargos', page=page+1, search=search, fecha_desde=request.args.get('fecha_desde'), fecha_hasta=request.args.get('fecha_hasta')) }}">
            <button>Siguiente &raquo;</button>
        </a>
    {% endif %}
</div>

<script src="{{ url_for('static', filename='js/eliminarRegistro.js') }}"></script>
{% endblock %}